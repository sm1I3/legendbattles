<?php

function bbCodes($text, $type)
{
    $smiles = array(array(array("005", "26", "24"), array("010", "21", "21"), array("012", "32", "27"), array("022", "21", "26"), array("024", "27", "35"), array("031", "24", "26"), array("053", "27", "26"), array("057", "27", "26"), array("058", "30", "28"), array("075", "31", "26"), array("079", "22", "26"), array("081", "31", "32"), array("083", "36", "27"), array("084", "21", "28"), array("088", "51", "28"), array("131", "33", "33")), array(array("008", "21", "25"), array("014", "21", "25"), array("015", "21", "25"), array("019", "21", "25"), array("020", "21", "25"), array("025", "21", "25"), array("026", "22", "21"), array("032", "21", "25"), array("037", "23", "26"), array("040", "21", "25"), array("043", "29", "25"), array("056", "35", "25"), array("070", "28", "28"), array("086", "32", "26"), array("087", "31", "26"), array("092", "39", "34"), array("111", "34", "23")), array(array("003", "35", "24"), array("004", "35", "24"), array("006", "36", "24"), array("007", "35", "25"), array("009", "35", "24"), array("011", "40", "24"), array("016", "36", "25"), array("055", "38", "25"), array("059", "35", "24"), array("067", "48", "30"), array("068", "40", "23"), array("078", "38", "30"), array("102", "41", "25"), array("105", "36", "24"), array("106", "35", "27"), array("109", "36", "28")), array(array("077", "35", "31"), array("095", "153", "40")), array(array("018", "31", "31"), array("021", "43", "26"), array("023", "35", "25"), array("028", "34", "25"), array("029", "39", "30"), array("034", "29", "25"), array("035", "27", "25"), array("042", "48", "43"), array("048", "25", "29"), array("050", "21", "28"), array("054", "21", "25"), array("061", "37", "26"), array("062", "38", "28"), array("063", "45", "30"), array("073", "38", "26"), array("074", "36", "33"), array("085", "52", "27"), array("115", "30", "26"), array("118", "41", "28"), array("119", "34", "27"), array("121", "36", "40"), array("122", "24", "28"), array("123", "37", "25"), array("124", "21", "25"), array("127", "35", "26"), array("129", "45", "34"), array("130", "38", "26"), array("132", "36", "23"), array("133", "37", "27"), array("134", "32", "36"), array("137", "26", "29"), array("138", "57", "29"), array("139", "26", "29"), array("147", "48", "25"), array("148", "32", "29"), array("149", "35", "30"), array("150", "31", "31"), array("151", "43", "27")), array(array("002", "25", "25"), array("017", "27", "26"), array("027", "37", "26"), array("036", "35", "25"), array("038", "39", "26"), array("039", "46", "29"), array("044", "36", "24"), array("045", "39", "25"), array("046", "55", "43"), array("051", "37", "24"), array("060", "37", "26"), array("069", "36", "24"), array("090", "54", "54"), array("096", "46", "26"), array("097", "46", "26"), array("098", "40", "26"), array("099", "37", "27"), array("100", "37", "24"), array("101", "36", "26"), array("104", "42", "25"), array("107", "35", "27"), array("108", "35", "27"), array("110", "39", "28"), array("112", "35", "25"), array("120", "36", "40"), array("140", "42", "27"), array("146", "46", "25")), array(array("041", "21", "25"), array("064", "46", "48"), array("071", "37", "25"), array("072", "41", "25"), array("076", "69", "37"), array("080", "49", "25"), array("089", "50", "46"), array("094", "30", "25"), array("125", "28", "26"), array("135", "44", "28"), array("136", "74", "28"), array("141", "39", "36"), array("142", "44", "27"), array("143", "42", "49"), array("144", "54", "36"), array("145", "42", "31")));
    $bbcodes = array("/&/is" => "&amp;", "/\"/is" => "&quot;", "/\'/is" => "\'", "/</is" => "&lt;", "/>/is" => "&gt;", "/\r\n/is" => "<br />", "/\n/is" => "<br />", "/\[b\](.*?)\[\/b\]/is" => "<b>$1</b>", "/\[i\](.*?)\[\/i\]/is" => "<i>$1</i>", "/\[u\](.*?)\[\/u\]/is" => "<u>$1</u>", "/\[center\](.*?)\[\/center\]/is" => "<center>$1</center>");
    $decodes = array("/&amp;/is" => "&", "/&quot;/is" => "\"", "/\'/is" => "\'", "/&lt;/is" => "<", "/&gt;/is" => ">", "/\<br \/\>/is" => "\r\n", "/\<b\>(.*?)\<\/b\>/is" => "[b]$1[/b]", "/\<i\>(.*?)\<\/i\>/is" => "[i]$1[/i]", "/\<u\>(.*?)\<\/u\>/is" => "[u]$1[/u]", "/\<center\>(.*?)\<\/center\>/is" => "[center]$1[/center]");
    if (!$type) {
        $player = player();
    } else {
        $player = GetUser();
    }
    $text = preg_replace(array_keys($bbcodes), array_values($bbcodes), $text);
    for ($k = 0; $k < count($smiles); $k++) {
        $forum_smiles = explode("|", $player['forum_smiles']);
        if (in_array(pow(2, $k), $forum_smiles)) {
            for ($m = 0; $m < count($smiles[$k]); $m++) {
                $text = preg_replace("/:" . $smiles[$k][$m][0] . ":/", '<img src=img/forum/smiles/' . $smiles[$k][$m][0] . '.gif width=' . $smiles[$k][$m][1] . ' height=' . $smiles[$k][$m][2] . ' border=0 align=absmiddle>', $text);
            }
        }
    }
    return $text;
}

function deCodes($text)
{
    $smiles = array(array(array("005", "26", "24"), array("010", "21", "21"), array("012", "32", "27"), array("022", "21", "26"), array("024", "27", "35"), array("031", "24", "26"), array("053", "27", "26"), array("057", "27", "26"), array("058", "30", "28"), array("075", "31", "26"), array("079", "22", "26"), array("081", "31", "32"), array("083", "36", "27"), array("084", "21", "28"), array("088", "51", "28"), array("131", "33", "33")), array(array("008", "21", "25"), array("014", "21", "25"), array("015", "21", "25"), array("019", "21", "25"), array("020", "21", "25"), array("025", "21", "25"), array("026", "22", "21"), array("032", "21", "25"), array("037", "23", "26"), array("040", "21", "25"), array("043", "29", "25"), array("056", "35", "25"), array("070", "28", "28"), array("086", "32", "26"), array("087", "31", "26"), array("092", "39", "34"), array("111", "34", "23")), array(array("003", "35", "24"), array("004", "35", "24"), array("006", "36", "24"), array("007", "35", "25"), array("009", "35", "24"), array("011", "40", "24"), array("016", "36", "25"), array("055", "38", "25"), array("059", "35", "24"), array("067", "48", "30"), array("068", "40", "23"), array("078", "38", "30"), array("102", "41", "25"), array("105", "36", "24"), array("106", "35", "27"), array("109", "36", "28")), array(array("077", "35", "31"), array("095", "153", "40")), array(array("018", "31", "31"), array("021", "43", "26"), array("023", "35", "25"), array("028", "34", "25"), array("029", "39", "30"), array("034", "29", "25"), array("035", "27", "25"), array("042", "48", "43"), array("048", "25", "29"), array("050", "21", "28"), array("054", "21", "25"), array("061", "37", "26"), array("062", "38", "28"), array("063", "45", "30"), array("073", "38", "26"), array("074", "36", "33"), array("085", "52", "27"), array("115", "30", "26"), array("118", "41", "28"), array("119", "34", "27"), array("121", "36", "40"), array("122", "24", "28"), array("123", "37", "25"), array("124", "21", "25"), array("127", "35", "26"), array("129", "45", "34"), array("130", "38", "26"), array("132", "36", "23"), array("133", "37", "27"), array("134", "32", "36"), array("137", "26", "29"), array("138", "57", "29"), array("139", "26", "29"), array("147", "48", "25"), array("148", "32", "29"), array("149", "35", "30"), array("150", "31", "31"), array("151", "43", "27")), array(array("002", "25", "25"), array("017", "27", "26"), array("027", "37", "26"), array("036", "35", "25"), array("038", "39", "26"), array("039", "46", "29"), array("044", "36", "24"), array("045", "39", "25"), array("046", "55", "43"), array("051", "37", "24"), array("060", "37", "26"), array("069", "36", "24"), array("090", "54", "54"), array("096", "46", "26"), array("097", "46", "26"), array("098", "40", "26"), array("099", "37", "27"), array("100", "37", "24"), array("101", "36", "26"), array("104", "42", "25"), array("107", "35", "27"), array("108", "35", "27"), array("110", "39", "28"), array("112", "35", "25"), array("120", "36", "40"), array("140", "42", "27"), array("146", "46", "25")), array(array("041", "21", "25"), array("064", "46", "48"), array("071", "37", "25"), array("072", "41", "25"), array("076", "69", "37"), array("080", "49", "25"), array("089", "50", "46"), array("094", "30", "25"), array("125", "28", "26"), array("135", "44", "28"), array("136", "74", "28"), array("141", "39", "36"), array("142", "44", "27"), array("143", "42", "49"), array("144", "54", "36"), array("145", "42", "31")));
    $bbcodes = array("/&/is" => "&amp;", "/\"/is" => "&quot;", "/\'/is" => "\'", "/</is" => "&lt;", "/>/is" => "&gt;", "/\r\n/is" => "<br />", "/\n/is" => "<br />", "/\[b\](.*?)\[\/b\]/is" => "<b>$1</b>", "/\[i\](.*?)\[\/i\]/is" => "<i>$1</i>", "/\[u\](.*?)\[\/u\]/is" => "<u>$1</u>", "/\[center\](.*?)\[\/center\]/is" => "<center>$1</center>");
    $decodes = array("/&amp;/is" => "&", "/&quot;/is" => "\"", "/\'/is" => "\'", "/&lt;/is" => "<", "/&gt;/is" => ">", "/\<br \/\>/is" => "\r\n", "/\<b\>(.*?)\<\/b\>/is" => "[b]$1[/b]", "/\<i\>(.*?)\<\/i\>/is" => "[i]$1[/i]", "/\<u\>(.*?)\<\/u\>/is" => "[u]$1[/u]", "/\<center\>(.*?)\<\/center\>/is" => "[center]$1[/center]");
    $player = player();
    $text = preg_replace(array_keys($decodes), array_values($decodes), $text);
    for ($k = 0; $k < count($smiles); $k++) {
        $forum_smiles = explode("|", $player['forum_smiles']);
        if (in_array(pow(2, $k), $forum_smiles)) {
            for ($m = 0; $m < count($smiles[$k]); $m++) {
                $text = preg_replace('/\<img src=\/img\/forum\/smiles\/' . $smiles[$k][$m][0] . '.gif width=' . $smiles[$k][$m][1] . ' height=' . $smiles[$k][$m][2] . ' border=0 align=absmiddle\>/', ":" . $smiles[$k][$m][0] . ":", $text);
            }
        }
    }
    return $text;
}
